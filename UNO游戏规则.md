# UNO 游戏规则

## 游戏概述

UNO是一款经典的卡牌游戏，目标是第一个出完所有手牌的玩家获胜。本项目实现的是支持2-6人的UNO游戏，包括人类玩家和AI机器人。

## 游戏配置系统

本项目采用简化的游戏配置系统，支持多种预设规则和自定义配置。

### 配置结构

游戏配置分为三个主要部分：

#### 基础设置 (basic)
- `initialHandSize`: 初始手牌数量（1-10张）

#### UNO规则 (uno)
- `enableUnoCheck`: 是否启用UNO宣告检查

#### 计分规则 (scoring)
- `numberCardPoints`: 数字卡是否按面值计分
- `specialCardPoints`: 特殊卡分值（跳过、反转、+2）
- `wildCardPoints`: 万能卡分值（变色、变色+4）

### 预设规则配置

#### 标准规则 (STANDARD_RULES)
```javascript
{
  basic: { initialHandSize: 7 },
  uno: { enableUnoCheck: true },
  scoring: {
    numberCardPoints: true,
    specialCardPoints: 20,
    wildCardPoints: 50
  }
}
```

#### 快速游戏 (QUICK_GAME_RULES)
- 初始手牌：5张
- 其他设置与标准规则相同
- 适合快速对局

#### 休闲模式 (CASUAL_RULES)
- 禁用UNO宣告检查
- 其他设置与标准规则相同
- 适合休闲娱乐

#### 竞技模式 (COMPETITIVE_RULES)
- 与标准规则完全相同
- 适合正式比赛

### AI与游戏配置集成

AI系统会根据当前游戏配置调整行为：

1. **UNO宣告**: AI根据`enableUnoCheck`决定是否需要宣告UNO
2. **卡牌评估**: AI使用配置中的分值来评估卡牌价值
3. **策略调整**: 不同配置下AI会采用相应的策略

## 卡牌组成

### 标准UNO牌堆（108张）

#### 数字卡（76张）
- **红色、蓝色、绿色、黄色**各19张：
  - 0卡：每种颜色1张（4张）
  - 1-9卡：每种颜色各2张（72张）

#### 特殊卡（24张）
- **跳过卡（Skip）**：每种颜色2张（8张）
- **反转卡（Reverse）**：每种颜色2张（8张）
- **+2卡（Draw Two）**：每种颜色2张（8张）

#### 万能卡（8张）
- **变色卡（Wild）**：4张
- **变色+4卡（Wild Draw Four）**：4张

## 游戏设置

### 初始设置
1. **玩家数量**：2-6人（包括AI）
2. **初始手牌**：根据配置设定（默认7张）
3. **牌堆**：剩余卡牌作为抽牌堆
4. **弃牌堆**：从抽牌堆翻开第一张作为起始卡
5. **游戏方向**：默认顺时针

### 特殊起始卡处理
- 如果起始卡是特殊卡，按以下规则处理：
  - **数字卡**：正常开始
  - **跳过卡**：第一个玩家被跳过
  - **反转卡**：改变游戏方向
  - **+2卡**：第一个玩家抽2张牌并被跳过
  - **万能卡**：重新洗牌并翻开新的起始卡

## 基本游戏流程

### 回合流程
1. **检查出牌条件**：玩家必须出一张符合规则的卡牌
2. **出牌或抽牌**：
   - 有可出卡牌：必须出牌
   - 无可出卡牌：从抽牌堆抽1张
3. **抽牌后选择**：
   - 抽到的卡可以出：可以立即出牌
   - 抽到的卡不能出：回合结束
4. **特殊效果处理**：执行出牌的特殊效果
5. **UNO宣告检查**：根据配置决定是否需要宣告UNO
6. **获胜检查**：手牌为空则获胜

### 出牌规则
玩家可以出牌的条件（满足其一即可）：
1. **颜色匹配**：与弃牌堆顶部卡牌颜色相同
2. **数字匹配**：与弃牌堆顶部卡牌数字相同（仅限数字卡）
3. **类型匹配**：与弃牌堆顶部卡牌类型相同（特殊卡）
4. **万能卡**：任何时候都可以出

## 特殊卡牌效果

### 跳过卡（Skip）
- **效果**：下一个玩家被跳过，不能出牌
- **叠加规则**：不可叠加

### 反转卡（Reverse）
- **效果**：改变游戏方向（顺时针↔逆时针）
- **2人游戏**：相当于跳过卡
- **叠加规则**：不可叠加

### +2卡（Draw Two）
- **效果**：下一个玩家抽2张牌并被跳过
- **叠加规则**：可以叠加
  - 如果下一个玩家也有+2卡，可以出牌将抽牌数累积给再下一个玩家
  - 累积的抽牌数会一直传递，直到有玩家无法出+2卡

### 变色卡（Wild）
- **效果**：出牌者选择新的颜色
- **使用条件**：任何时候都可以出
- **颜色选择**：必须选择红、蓝、绿、黄中的一种

### 变色+4卡（Wild Draw Four）
- **效果**：出牌者选择新颜色，下一个玩家抽4张牌并被跳过
- **使用条件**：只有在没有其他可出卡牌时才能使用
- **质疑规则**：下一个玩家可以质疑使用的合法性
- **叠加规则**：可以与其他变色+4卡叠加

## UNO宣告规则

### 宣告时机
- 当玩家手牌剩余**2张**时，出牌后剩余1张，必须立即宣告"UNO"
- 宣告必须在下一个玩家开始行动前完成
- **注意**：此规则受配置中的`enableUnoCheck`控制

### 忘记宣告的惩罚
- 如果玩家忘记宣告UNO，被其他玩家发现，必须抽2张牌作为惩罚
- 惩罚检查时机：在下一个玩家出牌前
- **注意**：仅在启用UNO检查时生效

### 宣告后的规则
- 宣告UNO后，如果又抽到牌导致手牌增加，需要重新宣告

## 质疑规则

### 变色+4卡质疑
- **质疑条件**：下一个玩家认为出牌者有其他可出的卡牌
- **质疑流程**：
  1. 下一个玩家选择质疑
  2. 检查出牌者的手牌
  3. 判断是否有其他可出的卡牌（除变色+4外）

### 质疑结果
- **质疑成功**：出牌者抽4张牌，质疑者正常游戏
- **质疑失败**：质疑者抽6张牌（原本的4张+惩罚2张）

## 获胜条件

### 单局获胜
- 第一个出完所有手牌的玩家获胜
- 获胜时必须已正确宣告UNO（如果启用UNO检查）

### 计分规则
计分规则根据游戏配置确定：

- **数字卡**：
  - 如果`numberCardPoints`为true：按面值计分（0-9分）
  - 如果`numberCardPoints`为false：不计分（0分）
- **特殊卡**：按配置中的`specialCardPoints`计分（默认20分）
- **万能卡**：按配置中的`wildCardPoints`计分（默认50分）
- **计分方式**：获胜者得到其他玩家手牌的总分

## 特殊情况处理

### 抽牌堆用完
- 将弃牌堆（除顶部卡牌）重新洗牌作为新的抽牌堆
- 保留弃牌堆顶部卡牌作为当前有效卡

### 同时出完牌
- 按出牌顺序判断，先出完的玩家获胜

### 无效出牌
- 玩家出了不符合规则的卡牌，必须收回并抽1张牌作为惩罚

## AI难度设置

### 简单AI
- 随机选择可出的卡牌
- 不会策略性保留特殊卡
- 基本的UNO宣告逻辑
- 简单的颜色选择策略

### 中等AI
- 优先出特殊卡和高分卡
- 会保留万能卡到关键时刻
- 智能的颜色选择
- 考虑对手威胁程度
- 准确的UNO宣告

### 困难AI
- 会记忆已出的卡牌
- 策略性选择出牌和颜色
- 会分析其他玩家的手牌数量和行为模式
- 深度战术思考和概率计算
- 完美的UNO宣告和时机把握
- 高级的卡牌价值评估

### AI配置集成
所有AI都会根据当前游戏配置调整策略：
- 根据`enableUnoCheck`决定UNO宣告行为
- 使用配置中的分值进行卡牌价值评估
- 根据`initialHandSize`调整游戏阶段判断

## 游戏变体规则（可选实现）

### 累积抽牌
- +2卡和变色+4卡可以互相叠加
- 抽牌数会一直累积直到有玩家无法继续叠加

### 跳过叠加
- 多张跳过卡可以叠加，跳过多个玩家

### 快速游戏
- 初始手牌减少到5张
- 某些特殊卡效果加强

## 实现优先级

### 第一阶段（核心规则）✅
1. ✅ 基本出牌规则
2. ✅ 特殊卡效果（跳过、反转、+2、万能卡）
3. ✅ UNO宣告基础逻辑
4. ✅ 基本获胜条件
5. ✅ 游戏配置系统
6. ✅ AI与配置集成

### 第二阶段（完整规则）
1. 🔄 变色+4卡的使用限制
2. 🔄 质疑系统
3. 🔄 UNO宣告惩罚
4. 🔄 抽牌堆重新洗牌

### 第三阶段（高级功能）
1. ⏳ 计分系统
2. ⏳ 游戏变体规则
3. ⏳ AI难度调节
4. ⏳ 游戏统计和历史

---

**注意**：本规则文档将作为开发的标准参考，所有游戏逻辑实现都应严格遵循此规则。游戏配置系统提供了灵活性，允许根据不同场景调整游戏规则。 